<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>YouTube Bulk Playlist Adder (Online Version)</title>
<style>
body { font-family: Arial; padding: 20px; max-width: 600px; margin: auto; }
textarea, input, button {
  width: 100%; padding: 12px; margin-top: 10px;
  font-size: 16px;
}
button { background: black; color: white; border: none; font-weight: bold; }
#log { margin-top: 20px; white-space: pre-wrap; background: #eee; padding: 10px; }
</style>
</head>
<body>

<h2>YouTube Bulk Playlist Adder (Online)</h2>
<p>Pastikan kamu LOGIN YouTube di browser yang sama.</p>

<textarea id="links" placeholder="Paste semua link YouTube..."></textarea>
<input id="playlist" placeholder="Playlist ID (PLxxxx...)">

<button onclick="start()">Add All</button>

<div id="log"></div>

<script>
async function sha1(str) {
    const buf = new TextEncoder().encode(str);
    const hash = await crypto.subtle.digest("SHA-1", buf);
    return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
}

async function getAuthHeaders() {
    const cookies = document.cookie;
    const sapisidCookie = cookies.split("; ").find(c => c.startsWith("SAPISID="));
    if (!sapisidCookie) return null;

    const SAPISID = sapisidCookie.split("=")[1];
    const origin = "https://www.youtube.com";
    const timestamp = Math.floor(Date.now() / 1000);

    const hash = await sha1(SAPISID + " " + origin);
    const auth = `SAPISIDHASH ${timestamp}_${hash}`;

    return {
        "Authorization": auth,
        "X-Origin": origin,
        "X-Goog-AuthUser": "0",
        "Content-Type": "application/json"
    };
}

function extractVideoId(url) {
    try {
        let u = new URL(url);
        if (u.hostname === "youtu.be") return u.pathname.slice(1);
        return u.searchParams.get("v");
    } catch {
        return null;
    }
}

async function addVideo(videoId, playlistId, headers) {
    const body = {
        context: {
            client: {
                clientName: "WEB",
                clientVersion: "2.20240201"
            }
        },
        actions: [{
            action: "ACTION_ADD_VIDEO",
            addedVideoId: videoId
        }],
        playlistId: playlistId
    };

    const url = "https://www.youtube.com/youtubei/v1/playlist/update?key=AIzaSyA1x3e8xz-HIDDEN";

    try {
        const res = await fetch(url, {
            method: "POST",
            headers,
            body: JSON.stringify(body),
            credentials: "include"
        });
        return res.ok;
    } catch {
        return false;
    }
}

async function start() {
    const links = document.getElementById("links").value.trim().split(/\s+/);
    const playlist = document.getElementById("playlist").value.trim();
    const log = document.getElementById("log");

    log.textContent = "Mengambil token login...\n";

    const headers = await getAuthHeaders();
    if (!headers) {
        log.textContent += "\n❌ Kamu belum login YouTube pada browser ini.";
        return;
    }

    log.textContent += "Token OK! Menambahkan video...\n\n";

    let count = 0;

    for (let i = 0; i < links.length; i++) {
        const id = extractVideoId(links[i]);
        if (!id) continue;

        const ok = await addVideo(id, playlist, headers);
        if (ok) {
            count++;
            log.textContent += `✔ Ditambahkan: ${links[i]}\n`;
        } else {
            log.textContent += `❌ Gagal: ${links[i]}\n`;
        }
    }

    log.textContent += `\nSelesai! Total berhasil: ${count}`;
}
</script>

</body>
</html>
